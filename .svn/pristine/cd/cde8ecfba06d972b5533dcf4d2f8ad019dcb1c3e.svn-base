package com.tygas.tianyu.tianyu.ui.view.activity;

import android.content.Intent;
import android.graphics.Color;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.text.TextUtils;
import android.util.Log;
import android.view.View;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.RelativeLayout;
import android.widget.TextView;

import com.tygas.tianyu.tianyu.R;
import com.tygas.tianyu.tianyu.utils.SystemBarUtils;
import com.wdullaer.materialdatetimepicker.date.DatePickerDialog;

import java.util.Calendar;

/**
 * Created by SJTY_YX on 2016/1/19.
 * 潜客筛选列表
 */
public class PtCustomersFilterActivity extends AppCompatActivity implements View.OnClickListener,DatePickerDialog.OnDateSetListener {

    private ImageView backImageView;//返回按钮

    private ImageView confirmTextView;//确定按钮
    private EditText nameEditText; //姓名
    private EditText phoneEditText;//电话
    private EditText empNameEditText;//员工姓名

    private RelativeLayout levelRelativeLayout;//等级的布局
    private int level;

    private RelativeLayout nextTimeRelativeLayout;
    private RelativeLayout lastTimeRelativeLayout;
    private TextView nextTimeTextView;
    private TextView lastTimeTextView;
    private DatePickerDialog dpd;

    private String begintime;
    private String endtime;

    private static final int CHOISE_COLOR = Color.rgb(161,225,156);//0xa1e19c; //等级默认的颜色
    private static final int DEFAULT_COLOR = Color.rgb(244,254,192);//0xf4fec0; //等级选中的颜色
    private static final String LOG_TAG = "PtCustomersFilterActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        SystemBarUtils.setSystemBarColor(this, "#327ECA");
        setContentView(R.layout.activity_ptcustomersfilter);
        begintime = getIntent().getStringExtra("begintime");
        endtime = getIntent().getStringExtra("endtime");
        initView();
    }

    private void initView() {

    backImageView = (ImageView) findViewById(R.id.activtiy_ptcustomersfilter_back);
    backImageView.setOnClickListener(this);

    confirmTextView = (ImageView) findViewById(R.id.activity_ptcustomersfilter_tv_confirm);
    confirmTextView.setOnClickListener(this);
    nameEditText = (EditText) findViewById(R.id.activity_ptcustomersfilter_et_name);
    phoneEditText = (EditText) findViewById(R.id.activity_ptcustomersfilter_et_phone);
        empNameEditText = (EditText) findViewById(R.id.activity_ptcustomersfilter_et_empName);
    levelRelativeLayout = (RelativeLayout) findViewById(R.id.activity_ptcustomersfilter_rl_level);
    setLevelColor();
    for(int i=0;i<levelRelativeLayout.getChildCount();i++){
        levelRelativeLayout.getChildAt(i).setOnClickListener(this);
    }

    nextTimeRelativeLayout = (RelativeLayout) findViewById(R.id.activity_ptcustomersfilter_rl_nexttime);
    lastTimeRelativeLayout= (RelativeLayout) findViewById(R.id.activity_ptcustomersfilter_rl_lasttime);
    nextTimeTextView = (TextView) nextTimeRelativeLayout.getChildAt(1);
    lastTimeTextView = (TextView) lastTimeRelativeLayout.getChildAt(1);
    Calendar now = Calendar.getInstance();
    String nowStr  = now.get(Calendar.YEAR)+"-"+(now.get(Calendar.MONTH)+1)+"-"+now.get(Calendar.DAY_OF_MONTH);
        if(begintime == null || begintime.equals("")){
            lastTimeTextView.setText(nowStr);
        }else{
            lastTimeTextView.setText(begintime);
        }
    if(endtime == null || endtime.equals("")){
        nextTimeTextView.setText(nowStr);
    }else{
        nextTimeTextView.setText(endtime);
    }
    lastTimeRelativeLayout.setOnClickListener(this);
    nextTimeRelativeLayout.setOnClickListener(this);
    dpd = DatePickerDialog.newInstance(
    PtCustomersFilterActivity.this,
            now.get(Calendar.YEAR),
            now.get(Calendar.MONTH),
            now.get(Calendar.DAY_OF_MONTH)
            );
    dpd.setAccentColor(Color.rgb(50, 126, 202));//327ECA
}//end initView


    private String getNowTime(){
        Calendar now = Calendar.getInstance();
        String nowStr  = now.get(Calendar.YEAR)+"-"+(now.get(Calendar.MONTH)+1)+"-"+now.get(Calendar.DAY_OF_MONTH);
        return nowStr;
    }

    private void setLevelColor(){
        if(levelRelativeLayout != null){
            for(int i=0;i<levelRelativeLayout.getChildCount();i++){
                TextView temp = (TextView) levelRelativeLayout.getChildAt(i);
                if(level == i){
                    temp.setBackgroundColor(CHOISE_COLOR);
                }else{
                    temp.setBackgroundColor(DEFAULT_COLOR);
                }
            }//end for
        }
    }//end setLevelColor

    //等级的点击监听
    @Override
    public void onClick(View v) {
        int id = v.getId();
        if(id == R.id.activity_ptcustomersfilter_rl_lasttime){
            //显示日期
            dpd.show(getFragmentManager(), "lasttime");
        }else if(id == R.id.activity_ptcustomersfilter_rl_nexttime){
            dpd.show(getFragmentManager(), "nexttime");
        }else if(id == R.id.activity_ptcustomersfilter_tv_confirm){
            //点击了确定按钮
            Intent intent = new Intent();
            if(!TextUtils.isEmpty(nameEditText.getText().toString())){
                intent.putExtra("name",nameEditText.getText().toString());
            }
            if(!TextUtils.isEmpty(phoneEditText.getText().toString())){
                intent.putExtra("phone",phoneEditText.getText().toString());
            }
            if(!TextUtils.isEmpty(empNameEditText.getText().toString())){
                intent.putExtra("empName",empNameEditText.getText().toString());
            }
            intent.putExtra("level",getLevelString());
            intent.putExtra("fromtime",lastTimeTextView.getText().toString());
            intent.putExtra("totime",nextTimeTextView.getText().toString());
            setResult(RESULT_OK, intent);
            finish();
        }else if(id == R.id.activtiy_ptcustomersfilter_back){//点击了返回按钮
            finish();
        }else{
            Integer position = Integer.valueOf((String) v.getTag());
            level = position;
            setLevelColor();
        }
    }//end onClick

    private String getLevelString(){
        switch (level){
            case 0:
                return "H";
            case 1:
                return "A";
            case 2:
                return "B";
            case 3:
                return "C";
            case 4:
                return "FR";
            case 5:
                return "F";
        }
        return "H";
    }

    @Override
    public void onDateSet(DatePickerDialog view, int year, int monthOfYear, int dayOfMonth) {
        String time = year+"-"+(monthOfYear+1)+"-"+dayOfMonth;
        String tag = view.getTag();
        if("lasttime".equals(tag)){
            lastTimeTextView.setText(time);
        }else if("nexttime".equals(tag)){
            nextTimeTextView.setText(time);
        }
    }//end onDateSet
}
