package com.tygas.tianyu.tianyu.ui.view.activity;

import android.app.ProgressDialog;
import android.graphics.Color;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.util.Log;
import android.view.View;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.TextView;

import com.tygas.tianyu.tianyu.R;
import com.wdullaer.materialdatetimepicker.date.DatePickerDialog;

import java.util.Calendar;

/**
 *
 * 回访失败
 * Created by SJTY_YX on 2016/1/21.
 *
 *
 */
public class ReturnVisitFail extends AppCompatActivity implements View.OnClickListener, DatePickerDialog.OnDateSetListener {

    private TextView duration;
    private TextView save;
    private ImageView playIcon;
    private EditText remark;
    private LinearLayout time;
    private TextView nextTime;
    private int nowPositon;//当前的 选择位置
    private DatePickerDialog dpd;
    private ProgressDialog progressDialog;
    private String callBackString;// "稍后回访"  明日回访  约定回访

    private static final String LOG_TAG = "ReturnVisitFail";


    private static final int CHOISE_COLOR = Color.rgb(161,225,156);//0xa1e19c; //等级默认的颜色
    private static final int DEFAULT_COLOR = Color.rgb(244,254,192);//0xf4fec0; //等级选中的颜色

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_returnvisitfail);
        initView();
    }

    private void initView() {
        save = (TextView) findViewById(R.id.activity_returnvisitfail_tv_save);
        save.setOnClickListener(this);
        duration = (TextView) findViewById(R.id.activity_returnvisitfail_tv_duration);
        playIcon = (ImageView) findViewById(R.id.activity_returnvisitfail_iv_playIcon);
        playIcon.setOnClickListener(this);
        remark = (EditText) findViewById(R.id.activity_returnvisitfail_et_remark);
        time = (LinearLayout) findViewById(R.id.activity_returnvisitfail_ll_time);
        for(int i=0;i<time.getChildCount();i++){
            time.getChildAt(i).setOnClickListener(this);
        }
        nextTime = (TextView) findViewById(R.id.activity_returnvisitfail_tv_nextTime);
        setColor();
        nextTime.setText(getNowTime());

        Calendar now = Calendar.getInstance();
        dpd = DatePickerDialog.newInstance(
                ReturnVisitFail.this,
                now.get(Calendar.YEAR),
                now.get(Calendar.MONTH),
                now.get(Calendar.DAY_OF_MONTH)
        );
        dpd.setAccentColor(Color.rgb(50, 126, 202));//327ECA

    }

    private void showDialog(String mes){
        if(progressDialog == null){
            progressDialog = new ProgressDialog(this);
        }
        progressDialog.setMessage(mes);
        progressDialog.show();
    }

    private void dismissDialog(){
        if(progressDialog != null && progressDialog.isShowing()){
            progressDialog.dismiss();
        }
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()){
            case R.id.activity_returnvisitfail_tv_later://稍后回访
                nowPositon = 0;
                setColor();
                nextTime.setText(getNowTime());
                callBackString = "稍后回访";
                break;
            case R.id.activity_returnvisitfail_tv_tom://明日
                nowPositon = 1;
                setColor();
                nextTime.setText(getNextTime());
                callBackString = "明日回访";
                break;
            case R.id.activity_returnvisitfail_tv_self://约定
                nowPositon = 2;
                setColor();
                dpd.show(getFragmentManager(), "nexttime");
                callBackString = "约定回访";
                break;
            case R.id.activity_returnvisitfail_tv_save:
                uploadDataToNet();
                break;
            case R.id.activity_returnvisitfail_iv_playIcon://播放

                break;
        }
    }//end onClick


    private void uploadDataToNet() {
        showDialog("提交中..");
        String bz  = remark.getText().toString();
        String callbackStr = callBackString;
        String time = nextTime.getText().toString();
        Log.i(LOG_TAG,"bz "+bz+"  ca"+callBackString+"   time"+time);
    }

    private void setColor(){
        for(int i=0;i<time.getChildCount();i++){
            if(i == nowPositon){
                time.getChildAt(i).setBackgroundColor(CHOISE_COLOR);
            }else{
                time.getChildAt(i).setBackgroundColor(DEFAULT_COLOR);
            }
        }
    }

    private String getNowTime(){
        Calendar cal=Calendar.getInstance();
        int y =cal.get(Calendar.YEAR);
        int m =cal.get(Calendar.MONTH)+1;
        int d =cal.get(Calendar.DATE);
        return y+"-"+m+"-"+d;
    }

    private String getNextTime(){
        Calendar cal=Calendar.getInstance();
        cal.add(Calendar.DAY_OF_YEAR, +1);
        int y =cal.get(Calendar.YEAR);
        int m =cal.get(Calendar.MONTH)+1;
        int d =cal.get(Calendar.DATE);
        return y+"-"+m+"-"+d;
    }

    @Override
    public void onDateSet(DatePickerDialog view, int year, int monthOfYear, int dayOfMonth) {
        nextTime.setText(year+"-"+(monthOfYear+1)+"-"+dayOfMonth);
    }
}
