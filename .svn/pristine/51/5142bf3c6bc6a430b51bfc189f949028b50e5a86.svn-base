package com.tygas.tianyu.tianyu.utils;


import com.lidroid.xutils.http.RequestParams;

import java.io.File;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.HashMap;
import java.util.Map;
import java.util.Set;

/**
 * Created by SJTY_YX on 2016/1/20.
 */
public class XutilsRequest {

    private static final String PC = "BQ2015";
    private static final String KEY = "zAt3B&#i&AcdWnHg";

    //获取到登录的参数
    public static RequestParams getLoginParams(String username,String password){
        RequestParams requestParams = new RequestParams();
        String ts = String.valueOf(System.currentTimeMillis());
        String data = "{\"user\":\""+username+"\",\"pw\":\""+sha1Code(password)+"\"}";
        String sign = getSign("login", PC, ts, data, KEY);
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);
        return requestParams;
    }

    //获取到意向客户的参数
    public static RequestParams getPcvList(String empid,String customername,String customerphone,
                                            String customerlevel,String begintime,String endtime,
                                            String pageindex,String pagesize){
        HashMap<String,String> map = new HashMap<>();
        map.put("empid",empid);
        map.put("customername",customername);
        map.put("customerphone",customerphone);
        map.put("customerlevel",customerlevel);
        map.put("begintime",begintime);
        map.put("endtime",endtime);
        map.put("pageindex",pageindex);
        map.put("pagesize",pagesize);
        String data = getJsonFromMap(map);
        String ts = String.valueOf(System.currentTimeMillis());
        String sign = getSign("pcvlist", PC, ts, data, KEY);
        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);
        return requestParams;
    }

    //意向客户跟进过程请求
    public static RequestParams getPc(String customerID){
        RequestParams requestParams = new RequestParams();
        String ts = String.valueOf(System.currentTimeMillis());
        String data = "{\"CustomerID\":\""+customerID+"\"}";
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);
        requestParams.addBodyParameter("sign",getSign("pc",PC,ts,data,KEY));
        return requestParams;
    }

    //回访请求
    public static RequestParams getVisit(String customerID,String empID,String talkProcess,
                                         String intentLevel,String isSuccess,String failBackType,
                                         String bakDateTime,String failType,String otherBrandName,
                                         String otherSeriesName,String isSubscribe,String quoteSituation,
                                         String subscribeDate,String remark){
        HashMap<String,String> data = new HashMap<>();
        data.put("CustomerID",customerID);
        data.put("EmpID",empID);
        data.put("TalkProcess",talkProcess);
        data.put("IntentLevel",intentLevel);
        data.put("IsSuccess",isSuccess);
        data.put("FailBackType",failBackType);
        data.put("BackDateTime",bakDateTime);
        data.put("FailType",failType);
        data.put("OtherBrandName",otherBrandName);
        data.put("OtherSeriesName",otherSeriesName);
        data.put("IsSubscribe",isSubscribe);
        data.put("QuoteSituation",quoteSituation);
        data.put("SubscribeDate",subscribeDate);
        data.put("Remark",remark);

        String dataStr = getJsonFromMap(data);
        String ts = String.valueOf(System.currentTimeMillis());
        String sign = getSign("visit",PC,ts,dataStr,KEY);//这里和文档不一样

        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",dataStr);
        requestParams.addBodyParameter("sign",sign);
        return requestParams;
    }


    //文件上传请求    -->文件上传有问题
    public static RequestParams getUploadFile(String callFollowID,String timeInt,File file){
        RequestParams requestParams = new RequestParams();

        HashMap<String,String> map = new HashMap<>();

        String ts = String.valueOf(System.currentTimeMillis());
       // String sign = getSign("uploadfile",PC,ts,)

        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("timeInt",timeInt);
        requestParams.addBodyParameter("CallFollowID",callFollowID);
        requestParams.addBodyParameter("recodeing",file);

        return requestParams;
    }


    //线索列表接口
    public static RequestParams getClueList(String empId,String clueName,String cluePhone,
                                            String isExpiry,String begintime,String endtime,
                                            String pageindex,String pagesize){
        HashMap<String,String> map = new HashMap<>();
        map.put("empid",empId);
        map.put("clueName",clueName);
        map.put("cluePhone",cluePhone);
        map.put("isExpiry",isExpiry);
        map.put("begintime",begintime);
        map.put("endtime",endtime);
        map.put("pageindex",pageindex);
        map.put("pagesize",pagesize);

        String ts = String.valueOf(System.currentTimeMillis());
        String data = getJsonFromMap(map);
        String sign = getSign("cluelist", PC, ts, data, KEY);

        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("data",data);

        return requestParams;
    }

    //线索明细
    public static RequestParams getClue(String clueID){
        RequestParams requestParams = new RequestParams();

        String ts = String.valueOf(System.currentTimeMillis());
        String data = "{\"clueID\":\""+clueID+"\"}";
        String sign = getSign("clue",PC,ts,data,KEY);

        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("data",data);
        return requestParams;
    }


    //线索跟踪接口
    public static RequestParams getCvisit(String clueID,String empID,String talkProcess,String intentLevel,
                                          String isSuccess,String failBackType,String backDateTime,String failType,
                                          String otherBrandName ,String otherSeriesName,String isSubscribe,String SubscribeDate,
                                          String Remark){
        HashMap<String,String> map = new HashMap<>();
        map.put("clueID",clueID);
        map.put("empID",empID);
        map.put("talkProcess",talkProcess);
        map.put("intentLevel",intentLevel);
        map.put("isSuccess",isSuccess);
        map.put("failBackType",failBackType);
        map.put("backDateTime",backDateTime);
        map.put("failType",failType);
        map.put("otherBrandName",otherBrandName);
        map.put("otherSeriesName",otherSeriesName);
        map.put("isSubscribe",isSubscribe);
        map.put("SubscribeDate",SubscribeDate);
        map.put("Remark",Remark);

        String ts = String.valueOf(System.currentTimeMillis());
        String data = getJsonFromMap(map);
        String sign = getSign("cvisit", PC, ts, data, KEY);

        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc","cvisit");
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);

        return requestParams;
    }


    //上传线索的录音 ????
    public static RequestParams getUploadClue(){
        return null;
    }


    //补全客户到店列表接口
    public static RequestParams getPcInfoList(String empid,String customerName,String customerPhone,
                                              String begintime,String endtime,String pageindex,String pagesize){
        HashMap<String,String> map = new HashMap<>();
        map.put("empid",empid);
        map.put("customerName",customerName);
        map.put("customerPhone",customerPhone);
        map.put("begintime",begintime);
        map.put("endtime",endtime);
        map.put("pageindex",pageindex);
        map.put("pagesize",pagesize);

        String data = getJsonFromMap(map);
        String ts = String.valueOf(System.currentTimeMillis());
        String sign = getSign("pcinfolist", PC, ts, data, KEY);

        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);

        return requestParams;
    }

    //补全客户信息
    public static RequestParams getPcInfoSave(String empID,String reciveComeID,String customerName,
                                              String customerPhone,String liveProvince,String liveCity,
                                              String liveArea,String channelId,String sourceChannelId,
                                              String oldCusCarNO,String isDrive,String followPeo,
                                              String intentLevel,String carSeriesName,String carModelName,
                                              String carColor,String UseageID,String IsChange,String FocusCarmodelID,
                                              String TalkProcess){
        HashMap<String,String> map  = new HashMap<>();
        map.put("empID",empID);
        map.put("reciveComeID",reciveComeID);
        map.put("customerName",customerName);
        map.put("customerPhone",customerPhone);
        map.put("liveProvince",liveProvince);
        map.put("liveCity",liveCity);
        map.put("liveArea",liveArea);
        map.put("channelId",channelId);
        map.put("sourceChannelId",sourceChannelId);
        map.put("oldCusCarNO",oldCusCarNO);
        map.put("isDrive",isDrive);
        map.put("followPeo",followPeo);
        map.put("intentLevel",intentLevel);
        map.put("carSeriesName",carSeriesName);
        map.put("carModelName",carModelName);
        map.put("carColor",carColor);
        map.put("UseageID",UseageID);
        map.put("IsChange",IsChange);
        map.put("FocusCarmodelID",FocusCarmodelID);
        map.put("TalkProcess",TalkProcess);

        String data = getJsonFromMap(map);
        String ts = String.valueOf(System.currentTimeMillis());
        String sign = getSign("pcinfosave", PC, ts, data, KEY);

        RequestParams requestParams = new RequestParams();
        requestParams.addBodyParameter("pc",PC);
        requestParams.addBodyParameter("sign",sign);
        requestParams.addBodyParameter("ts",ts);
        requestParams.addBodyParameter("data",data);

        return  requestParams;
    }

    private static String getJsonFromMap(Map<String,String> data){
        String result = "{";
        Set<Map.Entry<String, String>> entries = data.entrySet();
        for(Map.Entry<String,String> entry : entries){
            result += "\""+entry.getKey()+"\":"+"\""+entry.getValue()+"\",";
        }
        result = result.endsWith(",")? result.substring(0,result.length()-1) : result;
        return result+"}";
    }

    private static String getSign(String type,String pc,String time,String data,String key){
        StringBuffer sb = new StringBuffer();
        sb.append(type);
        sb.append(pc);
        sb.append(time);
        sb.append(data);
        sb.append(key);
        return md5Code(sb.toString()).toUpperCase();
    }

    private static String md5Code(String before){
        try {
            MessageDigest digest = MessageDigest.getInstance("MD5");
            byte[] hash = digest.digest(before.getBytes());
            StringBuilder hex = new StringBuilder();
            for (byte b : hash) {
                if ((b & 0xFF) < 0x10) hex.append("0");
                hex.append(Integer.toHexString(b & 0xFF));
            }

            return hex.toString();

        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        }
        return null;
    }

    private static String sha1Code(String before){
        try {
            MessageDigest digest = MessageDigest.getInstance("SHA-1");
            byte[] hash = digest.digest(before.getBytes());
            StringBuilder hex = new StringBuilder();
            for (byte b : hash) {
                if ((b & 0xFF) < 0x10) hex.append("0");
                hex.append(Integer.toHexString(b & 0xFF));
            }
            return hex.toString();
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        }
        return null;
    }

}
